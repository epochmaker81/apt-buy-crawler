# <<< 최종 버전 .github/workflows/main.yml >>>

name: Daily Apartment Data Update

on:
  workflow_dispatch: # 수동 실행을 위한 버튼 제공
  schedule:
    # cron 표현식 (UTC 기준). 아래는 매일 오전 7시(KST)에 실행됩니다.
    - cron: '0 22 * * *'

jobs:
  update-data:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Run Python script to update data
        env:
          # GitHub Secrets 값을 파이썬 스크립트의 환경 변수로 전달
          SERVICE_KEY: ${{ secrets.SERVICE_KEY }}
          GOOGLE_CREDENTIALS_JSON: ${{ secrets.GOOGLE_CREDENTIALS_JSON }}
          GSPREAD_SERVICE_ACCOUNT_EMAIL: ${{ secrets.GSPREAD_SERVICE_ACCOUNT_EMAIL }}
        run: python main.py
